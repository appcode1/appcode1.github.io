<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Index</title>
	<style>
	   .d-none {
	     display: none;
	   }
	   .text-center {
	     text-align: center;
		}
	</style>
  </head>
  <body>
	<div style="max-width:22rem;min-width:16rem;margin-left:auto;margin-right:auto;margin-top:3rem;">
		<h1 class="text-center">Hello World!</h1>
		<h2  id='divdt' class="text-center"></h2>
		<div id="divip" class="d-none text-center" style="margin-top:5rem;font-size:1.5rem;border:2px solid #f50660;border-radius:0.5rem;padding:1rem;">
		</div>
	</div>
  </body>
<script type="application/javascript">
    var divdt = document.getElementById('divdt');
	function startTime() {
		divdt.innerHTML = (new Date()).toLocaleString();
		setTimeout(startTime, 1000);
	}
	function getIP(json) {
		var divip = document.getElementById('divip');
		divip.innerHTML = json.ip;
		divip.classList.remove('d-none');
	}
	
	startTime();
</script>
<script type="application/javascript" src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
<script type="application/javascript">
	var _registerServiceWorker = function(){
        if (!navigator.serviceWorker) return;
        
        navigator.serviceWorker.register('sw.js').then(function(reg) {
           if(!navigator.serviceWorker.controller) return;

           if (reg.waiting) {
             _updateReady(reg.waiting);
             return;
           }

           if (reg.installing) {
             _trackInstalling(reg.installing);
             return;
           }

           reg.addEventListener('updatefound', function() {
             _trackInstalling(reg.installing);
           });
         });
       
         var refreshing;
         navigator.serviceWorker.addEventListener('controllerchange', function(){
             if(refreshing) return;
             window.location.reload();
             refreshing = true;
         });
   };
   var _trackInstalling = function(worker) {
       worker.addEventListener('statechange', function(){
           if(worker.state == 'installed') {
               _updateReady(worker);
           }
       });
   };
   var _updateReady = function(worker){
       //new version available
       worker.postMessage({action: 'skipWaiting'});
   };
   _registerServiceWorker();
</script>
</html>